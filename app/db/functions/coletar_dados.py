import pandas as pd
import pyodbc
import datetime as dt
import streamlit as st

def coletar():
    st.toast("Carregando dados")

    server = "192.168.5.225.1433"
    database = "PCP_PLANTA"
    username = "pcp.planta"
    password = "Planta@pcp2021"

    con_str = f"DRIVER={{ODBC Driver 17 for SQL Server}};SERVER={server};DATABASE={database};UID={username};PWD={password}"
    con = pyodbc.connect(con_str)

    laboratorio = pd.read_sql_query("SELECT CODIGO,DATA,ALIM_FLOT_PER_SOL,ALIM_FLOT_CU_TOT,ALIM_FLOT_FE,ALIM_FLOT_MG,ALIM_FLOT_NI,ALIM_FLOT_CU_SOL,ALIM_FLOT_S,CAST(ALIM_FLOT_AG AS nchar(100)) AS ALIM_FLOT_AG,CAST(ALIM_FLOT_AU AS nchar(100)) AS ALIM_FLOT_AU,CAST(ALIM_FLOT_GRANULOMETRIA AS nchar(100)) AS ALIM_FLOT_GRANULOMETRIA,CAST(ALIM_FLOT_REANALISE AS nchar(100)) AS ALIM_FLOT_REANALISE,CAST(ALIM_FLOT_HS_RECEB AS nchar(100)) AS ALIM_FLOT_HS_RECEB,CAST(ALIM_FLOT_HS_RESUL AS nchar(100)) AS ALIM_FLOT_HS_RESUL,CAST(RJ_FLOT_PER_SOL AS nchar(100)) AS RJ_FLOT_PER_SOL,CAST(REJ_FLOT_CU_TOT AS nchar(100)) AS REJ_FLOT_CU_TOT,CAST(REJ_FLOT_FE AS nchar(100)) AS REJ_FLOT_FE,CAST(REJ_FLOT_MG AS nchar(100)) AS REJ_FLOT_MG,CAST(REJ_FLOT_NI AS nchar(100)) AS REJ_FLOT_NI,CAST(REJ_FLOT_CU_SOL AS nchar(100)) AS REJ_FLOT_CU_SOL,CAST(REJ_FLOT_S AS nchar(100)) AS REJ_FLOT_S,CAST(REJ_FLOT_AG AS nchar(100)) AS REJ_FLOT_AG,CAST(REJ_FLOT_AU AS nchar(100)) AS REJ_FLOT_AU,CAST(REJ_FLOT_GRANULOMETRIA AS nchar(100)) AS REJ_FLOT_GRANULOMETRIA,CAST(REJ_FLOT_REANALISE AS nchar(100)) AS REJ_FLOT_REANALISE,CAST(CONC_FLOT_PER_SOL AS nchar(100)) AS CONC_FLOT_PER_SOL,CAST(CONC_FLOT_CU_TOT AS nchar(100)) AS CONC_FLOT_CU_TOT,CAST(CONC_FLOT_FE AS nchar(100)) AS CONC_FLOT_FE,CAST(CONC_FLOT_MG AS nchar(100)) AS CONC_FLOT_MG,CAST(CONC_FLOT_NI AS nchar(100)) AS CONC_FLOT_NI,CAST(CONC_FLOT_CU_SOL AS nchar(100)) AS CONC_FLOT_CU_SOL,CAST(CONC_FLOT_S AS nchar(100)) AS CONC_FLOT_S,CAST(CONC_FLOT_AG AS nchar(100)) AS CONC_FLOT_AG,CAST(CONC_FLOT_AU AS nchar(100)) AS CONC_FLOT_AU,CAST(CONC_FLOT_GRANULOMETRIA AS nchar(100)) AS CONC_FLOT_GRANULOMETRIA,CAST(CONC_FLOT_REANALISE AS nchar(100)) AS CONC_FLOT_REANALISE,CAST(CONC_ROUG_PER_SOL AS nchar(100)) AS CONC_ROUG_PER_SOL,CAST(CONC_ROUG_CU_TOT AS nchar(100)) AS CONC_ROUG_CU_TOT,CAST(CONC_ROUG_FE AS nchar(100)) AS CONC_ROUG_FE,CAST(CONC_ROUG_MG AS nchar(100)) AS CONC_ROUG_MG,CAST(CONC_ROUG_NI AS nchar(100)) AS CONC_ROUG_NI,CAST(CONC_ROUG_CU_SOL AS nchar(100)) AS CONC_ROUG_CU_SOL,CAST(CONC_ROUG_S AS nchar(100)) AS CONC_ROUG_S,CAST(CONC_ROUG_AG AS nchar(100)) AS CONC_ROUG_AG,CAST(CONC_ROUG_AU AS nchar(100)) AS CONC_ROUG_AU,CAST(CONC_ROUG_GRANULOMETRIA AS nchar(100)) AS CONC_ROUG_GRANULOMETRIA,CAST(CONC_ROUG_REANALISE AS nchar(100)) AS CONC_ROUG_REANALISE,CAST(REJ_ROUG_PER_SOL AS nchar(100)) AS REJ_ROUG_PER_SOL,CAST(REJ_ROUG_CU_TOT AS nchar(100)) AS REJ_ROUG_CU_TOT,CAST(REJ_ROUG_FE AS nchar(100)) AS REJ_ROUG_FE,CAST(REJ_ROUG_MG AS nchar(100)) AS REJ_ROUG_MG,CAST(REJ_ROUG_NI AS nchar(100)) AS REJ_ROUG_NI,CAST(REJ_ROUG_CU_SOL AS nchar(100)) AS REJ_ROUG_CU_SOL,CAST(REJ_ROUG_S AS nchar(100)) AS REJ_ROUG_S,CAST(REJ_ROUG_AG AS nchar(100)) AS REJ_ROUG_AG,CAST(REJ_ROUG_AU AS nchar(100)) AS REJ_ROUG_AU,CAST(REJ_ROUG_GRANULOMETRIA AS nchar(100)) AS REJ_ROUG_GRANULOMETRIA,CAST(REJ_ROUG_REANALISE AS nchar(100)) AS REJ_ROUG_REANALISE,CAST(CONC_CLEA_I_PER_SOL AS nchar(100)) AS CONC_CLEA_I_PER_SOL,CAST(CONC_CLEA_I_CU_TOT AS nchar(100)) AS CONC_CLEA_I_CU_TOT,CAST(CONC_CLEA_I_FE AS nchar(100)) AS CONC_CLEA_I_FE,CAST(CONC_CLEA_I_MG AS nchar(100)) AS CONC_CLEA_I_MG,CAST(CONC_CLEA_I_NI AS nchar(100)) AS CONC_CLEA_I_NI,CAST(CONC_CLEA_I_CU_SOL AS nchar(100)) AS CONC_CLEA_I_CU_SOL,CAST(CONC_CLEA_I_S AS nchar(100)) AS CONC_CLEA_I_S,CAST(CONC_CLEA_I_AG AS nchar(100)) AS CONC_CLEA_I_AG,CAST(CONC_CLEA_I_AU AS nchar(100)) AS CONC_CLEA_I_AU,CAST(CONC_CLEA_I_GRANULOMETRIA AS nchar(100)) AS CONC_CLEA_I_GRANULOMETRIA,CAST(CONC_CLEA_I_REANALISE AS nchar(100)) AS CONC_CLEA_I_REANALISE,CAST(REJ_CLEA_I_PER_SOL AS nchar(100)) AS REJ_CLEA_I_PER_SOL,CAST(REJ_CLEA_I_CU_TOT AS nchar(100)) AS REJ_CLEA_I_CU_TOT,CAST(REJ_CLEA_I_FE AS nchar(100)) AS REJ_CLEA_I_FE,CAST(REJ_CLEA_I_MG AS nchar(100)) AS REJ_CLEA_I_MG,CAST(REJ_CLEA_I_NI AS nchar(100)) AS REJ_CLEA_I_NI,CAST(REJ_CLEA_I_CU_SOL AS nchar(100)) AS REJ_CLEA_I_CU_SOL,CAST(REJ_CLEA_I_S AS nchar(100)) AS REJ_CLEA_I_S,CAST(REJ_CLEA_I_AG AS nchar(100)) AS REJ_CLEA_I_AG,CAST(REJ_CLEA_I_AU AS nchar(100)) AS REJ_CLEA_I_AU,CAST(REJ_CLEA_I_GRANULOMETRIA AS nchar(100)) AS REJ_CLEA_I_GRANULOMETRIA,CAST(REJ_CLEA_I_REANALISE AS nchar(100)) AS REJ_CLEA_I_REANALISE,CAST(CONC_CLEA_II_PER_SOL AS nchar(100)) AS CONC_CLEA_II_PER_SOL,CAST(CONC_CLEA_II_CU_TOT AS nchar(100)) AS CONC_CLEA_II_CU_TOT,CAST(CONC_CLEA_II_FE AS nchar(100)) AS CONC_CLEA_II_FE,CAST(CONC_CLEA_II_MG AS nchar(100)) AS CONC_CLEA_II_MG,CAST(CONC_CLEA_II_NI AS nchar(100)) AS CONC_CLEA_II_NI,CAST(CONC_CLEA_II_CU_SOL AS nchar(100)) AS CONC_CLEA_II_CU_SOL,CAST(CONC_CLEA_II_S AS nchar(100)) AS CONC_CLEA_II_S,CAST(CONC_CLEA_II_AG AS nchar(100)) AS CONC_CLEA_II_AG,CAST(CONC_CLEA_II_AU AS nchar(100)) AS CONC_CLEA_II_AU,CAST(CONC_CLEA_II_GRANULOMETRIA AS nchar(100)) AS CONC_CLEA_II_GRANULOMETRIA,CAST(CONC_CLEA_II_REANALISE AS nchar(100)) AS CONC_CLEA_II_REANALISE,CAST(REJ_CLEA_II_PER_SOL AS nchar(100)) AS REJ_CLEA_II_PER_SOL,CAST(REJ_CLEA_II_CU_TOT AS nchar(100)) AS REJ_CLEA_II_CU_TOT,CAST(REJ_CLEA_II_FE AS nchar(100)) AS REJ_CLEA_II_FE,CAST(REJ_CLEA_II_MG AS nchar(100)) AS REJ_CLEA_II_MG,CAST(REJ_CLEA_II_NI AS nchar(100)) AS REJ_CLEA_II_NI,CAST(REJ_CLEA_II_CU_SOL AS nchar(100)) AS REJ_CLEA_II_CU_SOL,CAST(REJ_CLEA_II_S AS nchar(100)) AS REJ_CLEA_II_S,CAST(REJ_CLEA_II_AG AS nchar(100)) AS REJ_CLEA_II_AG,CAST(REJ_CLEA_II_AU AS nchar(100)) AS REJ_CLEA_II_AU,CAST(REJ_CLEA_II_GRANULOMETRIA AS nchar(100)) AS REJ_CLEA_II_GRANULOMETRIA,CAST(REJ_CLEA_II_REANALISE AS nchar(100)) AS REJ_CLEA_II_REANALISE,CAST(CONC_SC_CL_PER_SOL AS nchar(100)) AS CONC_SC_CL_PER_SOL,CAST(CONC_SC_CL_CU_TOT AS nchar(100)) AS CONC_SC_CL_CU_TOT,CAST(CONC_SC_CL_FE AS nchar(100)) AS CONC_SC_CL_FE,CAST(CONC_SC_CL_MG AS nchar(100)) AS CONC_SC_CL_MG,CAST(CONC_SC_CL_NI AS nchar(100)) AS CONC_SC_CL_NI,CAST(CONC_SC_CL_CU_SOL AS nchar(100)) AS CONC_SC_CL_CU_SOL,CAST(CONC_SC_CL_S AS nchar(100)) AS CONC_SC_CL_S,CAST(CONC_SC_CL_AG AS nchar(100)) AS CONC_SC_CL_AG,CAST(CONC_SC_CL_AU AS nchar(100)) AS CONC_SC_CL_AU,CAST(CONC_SC_CL_GRANULOMETRIA AS nchar(100)) AS CONC_SC_CL_GRANULOMETRIA,CAST(CONC_SC_CL_REANALISE AS nchar(100)) AS CONC_SC_CL_REANALISE,CAST(REJ_SC_CL_PER_SOL AS nchar(100)) AS REJ_SC_CL_PER_SOL,CAST(REJ_SC_CL_CU_TOT AS nchar(100)) AS REJ_SC_CL_CU_TOT,CAST(REJ_SC_CL_FE AS nchar(100)) AS REJ_SC_CL_FE,CAST(REJ_SC_CL_MG AS nchar(100)) AS REJ_SC_CL_MG,CAST(REJ_SC_CL_NI AS nchar(100)) AS REJ_SC_CL_NI,CAST(REJ_SC_CL_CU_SOL AS nchar(100)) AS REJ_SC_CL_CU_SOL,CAST(REJ_SC_CL_S AS nchar(100)) AS REJ_SC_CL_S,CAST(REJ_SC_CL_AG AS nchar(100)) AS REJ_SC_CL_AG,CAST(REJ_SC_CL_AU AS nchar(100)) AS REJ_SC_CL_AU,CAST(REJ_SC_CL_GRANULOMETRIA AS nchar(100)) AS REJ_SC_CL_GRANULOMETRIA,CAST(REJ_SC_CL_REANALISE AS nchar(100)) AS REJ_SC_CL_REANALISE,CAST(OBS AS nchar(100)) AS OBS,CAST(CODIGO_AMOSTRA AS nchar(100)) AS CODIGO_AMOSTRA,CAST(CONC_RG_FC1_PER_SOL AS nchar(100)) AS CONC_RG_FC1_PER_SOL,CAST(CONC_RG_FC1_CU_TOT AS nchar(100)) AS CONC_RG_FC1_CU_TOT,CAST(CONC_RG_FC1_FE AS nchar(100)) AS CONC_RG_FC1_FE,CAST(CONC_RG_FC1_MG AS nchar(100)) AS CONC_RG_FC1_MG,CAST(CONC_RG_FC1_NI AS nchar(100)) AS CONC_RG_FC1_NI,CAST(CONC_RG_FC1_CU_SOL AS nchar(100)) AS CONC_RG_FC1_CU_SOL,CAST(CONC_RG_FC1_S AS nchar(100)) AS CONC_RG_FC1_S,CAST(CONC_RG_FC1_AG AS nchar(100)) AS CONC_RG_FC1_AG,CAST(CONC_RG_FC1_AU AS nchar(100)) AS CONC_RG_FC1_AU,CAST(CONC_RG_FC1_GRANULOMETRIA AS nchar(100)) AS CONC_RG_FC1_GRANULOMETRIA,CAST(CONC_RG_FC1_REANALISE AS nchar(100)) AS CONC_RG_FC1_REANALISE,CONC_ESPE_CONC,EXPURG_CU,EXPURG_H2O,SOLIDO_TK02,ALM_MOI_CU,ALM_MOI_FE,ALM_MOI_NI,ALM_MOI_MG,ALM_MOI_S,ALM_MOI_AG,ALM_MOI_AU,ALM_MOI_CU_CITR,ALM_MOI_H2O,REJ_RG_FC1_PER_SOL,REJ_RG_FC1_CU_TOT,REJ_RG_FC1_FE,REJ_RG_FC1_MG,REJ_RG_FC1_NI,REJ_RG_FC1_CU_SOL,REJ_RG_FC1_S,REJ_RG_FC1_AG,REJ_RG_FC1_AU,REJ_RG_FC1_GRANULOMETRIA,REJ_RG_FC1_REANALISE,REJ_RG_FC4_PER_SOL,REJ_RG_FC4_CU_TOT,REJ_RG_FC4_FE,REJ_RG_FC4_MG,REJ_RG_FC4_NI,REJ_RG_FC4_CU_SOL,REJ_RG_FC4_S,REJ_RG_FC4_AG,REJ_RG_FC4_AU,REJ_RG_FC4_GRANULOMETRIA,REJ_RG_FC4_REANALISE,REJ_RG_CD_PER_SOL,REJ_RG_CD_CU_TOT,REJ_RG_CD_FE,REJ_RG_CD_MG,REJ_RG_CD_NI,REJ_RG_CD_CU_SOL,REJ_RG_CD_S,REJ_RG_CD_AG,REJ_RG_CD_AU,REJ_RG_CD_GRANULOMETRIA,REJ_RG_CD_REANALISE,ALIM_CHG_CU_TOT,CONC_CHG_CU_TOT,REJ_CHG_CU_TOT,CONC_ROUG2_CU_TOT,REJ_ROUG2_CU_TOT,CONC_ROUG_FC01_CUT FROM LABORATORIO", con)
    
    laboratorio_raiox = pd.read_sql_query("SELECT CODIGO,DATA, CAST(CODIGO_AMOSTRA AS nchar(100)) AS CODIGO_AMOSTRA, CAST(ALIM_FLOT_HS_RECEB  AS nchar(100)) AS ALIM_FLOT_HS_RECEB, CAST(ALIM_FLOT_HS_RESUL  AS nchar(100)) AS ALIM_FLOT_HS_RESUL, CAST(ALIM_FLOT_PER_SOL  AS nchar(100)) AS ALIM_FLOT_PER_SOL, CAST(ALIM_FLOT_CU_TOT  AS nchar(100)) AS ALIM_FLOT_CU_TOT, CAST(ALIM_FLOT_FE  AS nchar(100)) AS ALIM_FLOT_FE, CAST(ALIM_FLOT_MG  AS nchar(100)) AS ALIM_FLOT_MG, CAST(ALIM_FLOT_NI  AS nchar(100)) AS ALIM_FLOT_NI, CAST(ALIM_FLOT_SIO2  AS nchar(100)) AS ALIM_FLOT_SIO2, CAST(ALIM_FLOT_Al2O3  AS nchar(100)) AS ALIM_FLOT_Al2O3, CAST(ALIM_FLOT_K20  AS nchar(100)) AS ALIM_FLOT_K20, CAST(ALIM_FLOT_CaO  AS nchar(100)) AS ALIM_FLOT_CaO, CAST(ALIM_FLOT_TiO2  AS nchar(100)) AS ALIM_FLOT_TiO2, CAST(ALIM_FLOT_S  AS nchar(100)) AS ALIM_FLOT_S, CAST(ALIM_FLOT_REANALISE  AS nchar(100)) AS ALIM_FLOT_REANALISE, CAST(RJ_FLOT_PER_SOL  AS nchar(100)) AS RJ_FLOT_PER_SOL, CAST(REJ_FLOT_CU_TOT  AS nchar(100)) AS REJ_FLOT_CU_TOT, CAST(REJ_FLOT_FE  AS nchar(100)) AS REJ_FLOT_FE, CAST(REJ_FLOT_MG  AS nchar(100)) AS REJ_FLOT_MG, CAST(REJ_FLOT_NI  AS nchar(100)) AS REJ_FLOT_NI, CAST(REJ_FLOT_SIO2  AS nchar(100)) AS REJ_FLOT_SIO2, CAST(REJ_FLOT_Al2O3  AS nchar(100)) AS REJ_FLOT_Al2O3, CAST(REJ_FLOT_K20  AS nchar(100)) AS REJ_FLOT_K20, CAST(REJ_FLOT_CaO  AS nchar(100)) AS REJ_FLOT_CaO, CAST(REJ_FLOT_TiO2  AS nchar(100)) AS REJ_FLOT_TiO2, CAST(REJ_FLOT_S  AS nchar(100)) AS REJ_FLOT_S, CAST(REJ_FLOT_REANALISE  AS nchar(100)) AS REJ_FLOT_REANALISE, CAST(CONC_FLOT_PER_SOL  AS nchar(100)) AS CONC_FLOT_PER_SOL, CAST(CONC_FLOT_CU_TOT  AS nchar(100)) AS CONC_FLOT_CU_TOT, CAST(CONC_FLOT_FE  AS nchar(100)) AS CONC_FLOT_FE, CAST(CONC_FLOT_MG  AS nchar(100)) AS CONC_FLOT_MG, CAST(CONC_FLOT_NI  AS nchar(100)) AS CONC_FLOT_NI, CAST(CONC_FLOT_SIO2  AS nchar(100)) AS CONC_FLOT_SIO2, CAST(CONC_FLOT_Al2O3  AS nchar(100)) AS CONC_FLOT_Al2O3, CAST(CONC_FLOT_K20  AS nchar(100)) AS CONC_FLOT_K20, CAST(CONC_FLOT_CaO  AS nchar(100)) AS CONC_FLOT_CaO, CAST(CONC_FLOT_TiO2  AS nchar(100)) AS CONC_FLOT_TiO2, CAST(CONC_FLOT_S  AS nchar(100)) AS CONC_FLOT_S, CAST(CONC_FLOT_REANALISE  AS nchar(100)) AS CONC_FLOT_REANALISE, CAST(CONC_ROUG_PER_SOL  AS nchar(100)) AS CONC_ROUG_PER_SOL, CAST(CONC_ROUG_CU_TOT  AS nchar(100)) AS CONC_ROUG_CU_TOT, CAST(CONC_ROUG_FE  AS nchar(100)) AS CONC_ROUG_FE, CAST(CONC_ROUG_MG  AS nchar(100)) AS CONC_ROUG_MG, CAST(CONC_ROUG_NI  AS nchar(100)) AS CONC_ROUG_NI, CAST(CONC_ROUG_FLOT_SIO2  AS nchar(100)) AS CONC_ROUG_FLOT_SIO2, CAST(CONC_ROUG_FLOT_Al2O3  AS nchar(100)) AS CONC_ROUG_FLOT_Al2O3, CAST(CONC_ROUG_FLOT_K20  AS nchar(100)) AS CONC_ROUG_FLOT_K20, CAST(CONC_ROUG_FLOT_CaO  AS nchar(100)) AS CONC_ROUG_FLOT_CaO, CAST(CONC_ROUG_FLOT_TiO2  AS nchar(100)) AS CONC_ROUG_FLOT_TiO2, CAST(CONC_ROUG_FLOT_S  AS nchar(100)) AS CONC_ROUG_FLOT_S, CAST(CONC_ROUG_REANALISE  AS nchar(100)) AS CONC_ROUG_REANALISE, CAST(REJ_ROUG_PER_SOL  AS nchar(100)) AS REJ_ROUG_PER_SOL, CAST(REJ_ROUG_CU_TOT  AS nchar(100)) AS REJ_ROUG_CU_TOT, CAST(REJ_ROUG_FE  AS nchar(100)) AS REJ_ROUG_FE, CAST(REJ_ROUG_MG  AS nchar(100)) AS REJ_ROUG_MG, CAST(REJ_ROUG_NI  AS nchar(100)) AS REJ_ROUG_NI, CAST(REJ_ROUG_FLOT_SIO2  AS nchar(100)) AS REJ_ROUG_FLOT_SIO2, CAST(REJ_ROUG_FLOT_Al2O3  AS nchar(100)) AS REJ_ROUG_FLOT_Al2O3, CAST(REJ_ROUG_FLOT_K20  AS nchar(100)) AS REJ_ROUG_FLOT_K20, CAST(REJ_ROUG_FLOT_CaO  AS nchar(100)) AS REJ_ROUG_FLOT_CaO, CAST(REJ_ROUG_FLOT_TiO2  AS nchar(100)) AS REJ_ROUG_FLOT_TiO2, CAST(REJ_ROUG_FLOT_S  AS nchar(100)) AS REJ_ROUG_FLOT_S, CAST(REJ_ROUG_REANALISE  AS nchar(100)) AS REJ_ROUG_REANALISE, CAST(CONC_CLEA_I_PER_SOL  AS nchar(100)) AS CONC_CLEA_I_PER_SOL, CAST(CONC_CLEA_I_CU_TOT  AS nchar(100)) AS CONC_CLEA_I_CU_TOT, CAST(CONC_CLEA_I_FE  AS nchar(100)) AS CONC_CLEA_I_FE, CAST(CONC_CLEA_I_MG  AS nchar(100)) AS CONC_CLEA_I_MG, CAST(CONC_CLEA_I_NI  AS nchar(100)) AS CONC_CLEA_I_NI, CAST(CONC_CLEA_I_SIO2  AS nchar(100)) AS CONC_CLEA_I_SIO2, CAST(CONC_CLEA_I_Al2O3  AS nchar(100)) AS CONC_CLEA_I_Al2O3, CAST(CONC_CLEA_I_K20  AS nchar(100)) AS CONC_CLEA_I_K20, CAST(CONC_CLEA_I_CaO  AS nchar(100)) AS CONC_CLEA_I_CaO, CAST(CONC_CLEA_I_TiO2  AS nchar(100)) AS CONC_CLEA_I_TiO2, CAST(CONC_CLEA_I_S  AS nchar(100)) AS CONC_CLEA_I_S, CAST(CONC_CLEA_I_REANALISE  AS nchar(100)) AS CONC_CLEA_I_REANALISE, CAST(REJ_CLEA_I_PER_SOL  AS nchar(100)) AS REJ_CLEA_I_PER_SOL, CAST(REJ_CLEA_I_CU_TOT  AS nchar(100)) AS REJ_CLEA_I_CU_TOT, CAST(REJ_CLEA_I_FE  AS nchar(100)) AS REJ_CLEA_I_FE, CAST(REJ_CLEA_I_MG  AS nchar(100)) AS REJ_CLEA_I_MG, CAST(REJ_CLEA_I_NI  AS nchar(100)) AS REJ_CLEA_I_NI, CAST(REJ_CLEA_I_SIO2  AS nchar(100)) AS REJ_CLEA_I_SIO2, CAST(REJ_CLEA_I_Al2O3  AS nchar(100)) AS REJ_CLEA_I_Al2O3, CAST(REJ_CLEA_I_K20  AS nchar(100)) AS REJ_CLEA_I_K20, CAST(REJ_CLEA_I_CaO  AS nchar(100)) AS REJ_CLEA_I_CaO, CAST(REJ_CLEA_I_TiO2  AS nchar(100)) AS REJ_CLEA_I_TiO2, CAST(REJ_CLEA_I_S  AS nchar(100)) AS REJ_CLEA_I_S, CAST(REJ_CLEA_I_REANALISE  AS nchar(100)) AS REJ_CLEA_I_REANALISE, CAST(CONC_CLEA_II_PER_SOL  AS nchar(100)) AS CONC_CLEA_II_PER_SOL, CAST(CONC_CLEA_II_CU_TOT  AS nchar(100)) AS CONC_CLEA_II_CU_TOT, CAST(CONC_CLEA_II_FE  AS nchar(100)) AS CONC_CLEA_II_FE, CAST(CONC_CLEA_II_MG  AS nchar(100)) AS CONC_CLEA_II_MG, CAST(CONC_CLEA_II_NI  AS nchar(100)) AS CONC_CLEA_II_NI, CAST(CONC_CLEA_II_SIO2  AS nchar(100)) AS CONC_CLEA_II_SIO2, CAST(CONC_CLEA_II_Al2O3  AS nchar(100)) AS CONC_CLEA_II_Al2O3, CAST(CONC_CLEA_II_K20  AS nchar(100)) AS CONC_CLEA_II_K20, CAST(CONC_CLEA_II_CaO  AS nchar(100)) AS CONC_CLEA_II_CaO, CAST(CONC_CLEA_II_TiO2  AS nchar(100)) AS CONC_CLEA_II_TiO2, CAST(CONC_CLEA_II_S  AS nchar(100)) AS CONC_CLEA_II_S, CAST(CONC_CLEA_II_REANALISE  AS nchar(100)) AS CONC_CLEA_II_REANALISE, CAST(REJ_CLEA_II_PER_SOL  AS nchar(100)) AS REJ_CLEA_II_PER_SOL, CAST(REJ_CLEA_II_CU_TOT  AS nchar(100)) AS REJ_CLEA_II_CU_TOT, CAST(REJ_CLEA_II_FE  AS nchar(100)) AS REJ_CLEA_II_FE, CAST(REJ_CLEA_II_MG  AS nchar(100)) AS REJ_CLEA_II_MG, CAST(REJ_CLEA_II_NI  AS nchar(100)) AS REJ_CLEA_II_NI, CAST(REJ_CLEA_II_SIO2  AS nchar(100)) AS REJ_CLEA_II_SIO2, CAST(REJ_CLEA_II_Al2O3  AS nchar(100)) AS REJ_CLEA_II_Al2O3, CAST(REJ_CLEA_II_K20  AS nchar(100)) AS REJ_CLEA_II_K20, CAST(REJ_CLEA_II_CaO  AS nchar(100)) AS REJ_CLEA_II_CaO, CAST(REJ_CLEA_II_TiO2  AS nchar(100)) AS REJ_CLEA_II_TiO2, CAST(REJ_CLEA_II_S  AS nchar(100)) AS REJ_CLEA_II_S, CAST(REJ_CLEA_II_REANALISE  AS nchar(100)) AS REJ_CLEA_II_REANALISE, CAST(CONC_SC_CL_PER_SOL  AS nchar(100)) AS CONC_SC_CL_PER_SOL, CAST(CONC_SC_CL_CU_TOT  AS nchar(100)) AS CONC_SC_CL_CU_TOT, CAST(CONC_SC_CL_FE  AS nchar(100)) AS CONC_SC_CL_FE, CAST(CONC_SC_CL_MG  AS nchar(100)) AS CONC_SC_CL_MG, CAST(CONC_SC_CL_NI  AS nchar(100)) AS CONC_SC_CL_NI, CAST(CONC_SC_CL_SIO2  AS nchar(100)) AS CONC_SC_CL_SIO2, CAST(CONC_SC_CL_Al2O3  AS nchar(100)) AS CONC_SC_CL_Al2O3, CAST(CONC_SC_CL_K20  AS nchar(100)) AS CONC_SC_CL_K20, CAST(CONC_SC_CL_CaO  AS nchar(100)) AS CONC_SC_CL_CaO, CAST(CONC_SC_CL_TiO2  AS nchar(100)) AS CONC_SC_CL_TiO2, CAST(CONC_SC_CL_S  AS nchar(100)) AS CONC_SC_CL_S, CAST(CONC_SC_CL_REANALISE  AS nchar(100)) AS CONC_SC_CL_REANALISE, CAST(REJ_SC_CL_PER_SOL  AS nchar(100)) AS REJ_SC_CL_PER_SOL, CAST(REJ_SC_CL_CU_TOT  AS nchar(100)) AS REJ_SC_CL_CU_TOT, CAST(REJ_SC_CL_FE  AS nchar(100)) AS REJ_SC_CL_FE, CAST(REJ_SC_CL_MG  AS nchar(100)) AS REJ_SC_CL_MG, CAST(REJ_SC_CL_NI  AS nchar(100)) AS REJ_SC_CL_NI, CAST(REJ_SC_CL_SIO2  AS nchar(100)) AS REJ_SC_CL_SIO2, CAST(REJ_SC_CL_Al2O3  AS nchar(100)) AS REJ_SC_CL_Al2O3, CAST(REJ_SC_CL_K20  AS nchar(100)) AS REJ_SC_CL_K20, CAST(REJ_SC_CL_CaO  AS nchar(100)) AS REJ_SC_CL_CaO, CAST(REJ_SC_CL_TiO2  AS nchar(100)) AS REJ_SC_CL_TiO2, CAST(REJ_SC_CL_S  AS nchar(100)) AS REJ_SC_CL_S, CAST(REJ_SC_CL_REANALISE  AS nchar(100)) AS REJ_SC_CL_REANALISE, CAST(OBS  AS nchar(100)) AS OBS, CAST(CONC_ROUG_FC01_PER_SOL  AS nchar(100)) AS CONC_ROUG_FC01_PER_SOL, CAST(CONC_ROUG_FC01_CUT  AS nchar(100)) AS CONC_ROUG_FC01_CUT, CAST(CONC_ROUG_FC01_FE  AS nchar(100)) AS CONC_ROUG_FC01_FE, CAST(CONC_ROUG_FC01_MG  AS nchar(100)) AS CONC_ROUG_FC01_MG, CAST(CONC_ROUG_FC01_NI  AS nchar(100)) AS CONC_ROUG_FC01_NI, CAST(CONC_ROUG_FC01_SIO2  AS nchar(100)) AS CONC_ROUG_FC01_SIO2, CAST(CONC_ROUG_FC01_AL2O3  AS nchar(100)) AS CONC_ROUG_FC01_AL2O3, CAST(CONC_ROUG_FC01_K2O  AS nchar(100)) AS CONC_ROUG_FC01_K2O, CAST(CONC_ROUG_FC01_CAO  AS nchar(100)) AS CONC_ROUG_FC01_CAO, CAST(CONC_ROUG_FC01_TIO2  AS nchar(100)) AS CONC_ROUG_FC01_TIO2, CAST(CONC_ROUG_FC01_S  AS nchar(100)) AS CONC_ROUG_FC01_S, CAST(CONC_ROUG_FC01_REANALISE  AS nchar(100)) AS CONC_ROUG_FC01_REANALISE, CAST(ALIM_MOINHO_PER_SOL  AS nchar(100)) AS ALIM_MOINHO_PER_SOL, CAST(ALIM_MOINHO_CUT  AS nchar(100)) AS ALIM_MOINHO_CUT, CAST(ALIM_MOINHO_FE  AS nchar(100)) AS ALIM_MOINHO_FE, CAST(ALIM_MOINHO_MG  AS nchar(100)) AS ALIM_MOINHO_MG, CAST(ALIM_MOINHO_NI  AS nchar(100)) AS ALIM_MOINHO_NI, CAST(ALIM_MOINHO_SIO2  AS nchar(100)) AS ALIM_MOINHO_SIO2, CAST(ALIM_MOINHO_AL2O3  AS nchar(100)) AS ALIM_MOINHO_AL2O3, CAST(ALIM_MOINHO_K2O  AS nchar(100)) AS ALIM_MOINHO_K2O, CAST(ALIM_MOINHO_CAO  AS nchar(100)) AS ALIM_MOINHO_CAO, CAST(ALIM_MOINHO_TIO2  AS nchar(100)) AS ALIM_MOINHO_TIO2, CAST(ALIM_MOINHO_S  AS nchar(100)) AS ALIM_MOINHO_S, CAST(ALIM_MOINHO_H2O  AS nchar(100)) AS ALIM_MOINHO_H2O, CAST(ALIM_MOINHO_REANALISE  AS nchar(100)) AS ALIM_MOINHO_REANALISE, CAST(ALIM_MOINHO_OBS  AS nchar(100)) AS ALIM_MOINHO_OBS, CAST(ALIM_CHG_CU_TOT  AS nchar(100)) AS ALIM_CHG_CU_TOT, CAST(ALIM_CHG_FE  AS nchar(100)) AS ALIM_CHG_FE, CAST(ALIM_CHG_MG  AS nchar(100)) AS ALIM_CHG_MG, CAST(ALIM_CHG_NI  AS nchar(100)) AS ALIM_CHG_NI, CAST(ALIM_CHG_SIO2  AS nchar(100)) AS ALIM_CHG_SIO2, CAST(ALIM_CHG_AL2O3  AS nchar(100)) AS ALIM_CHG_AL2O3, CAST(ALIM_CHG_K2O  AS nchar(100)) AS ALIM_CHG_K2O, CAST(ALIM_CHG_CAO  AS nchar(100)) AS ALIM_CHG_CAO, CAST(ALIM_CHG_TIO2  AS nchar(100)) AS ALIM_CHG_TIO2, CAST(ALIM_CHG_S  AS nchar(100)) AS ALIM_CHG_S, CAST(CONC_CHG_CU_TOT  AS nchar(100)) AS CONC_CHG_CU_TOT, CAST(CONC_CHG_FE  AS nchar(100)) AS CONC_CHG_FE, CAST(CONC_CHG_MG  AS nchar(100)) AS CONC_CHG_MG, CAST(CONC_CHG_NI  AS nchar(100)) AS CONC_CHG_NI, CAST(CONC_CHG_SIO2  AS nchar(100)) AS CONC_CHG_SIO2, CAST(CONC_CHG_AL2O3  AS nchar(100)) AS CONC_CHG_AL2O3, CAST(CONC_CHG_K2O  AS nchar(100)) AS CONC_CHG_K2O, CAST(CONC_CHG_CAO  AS nchar(100)) AS CONC_CHG_CAO, CAST(CONC_CHG_TIO2  AS nchar(100)) AS CONC_CHG_TIO2, CAST(CONC_CHG_S  AS nchar(100)) AS CONC_CHG_S, CAST(REJ_CHG_CU_TOT  AS nchar(100)) AS REJ_CHG_CU_TOT, CAST(REJ_CHG_FE  AS nchar(100)) AS REJ_CHG_FE, CAST(REJ_CHG_MG  AS nchar(100)) AS REJ_CHG_MG, CAST(REJ_CHG_NI  AS nchar(100)) AS REJ_CHG_NI, CAST(REJ_CHG_SIO2  AS nchar(100)) AS REJ_CHG_SIO2, CAST(REJ_CHG_AL2O3  AS nchar(100)) AS REJ_CHG_AL2O3, CAST(REJ_CHG_K2O  AS nchar(100)) AS REJ_CHG_K2O, CAST(REJ_CHG_CAO  AS nchar(100)) AS REJ_CHG_CAO, CAST(REJ_CHG_TIO2  AS nchar(100)) AS REJ_CHG_TIO2, CAST(REJ_CHG_S  AS nchar(100)) AS REJ_CHG_S, CAST(CONC_ROUG2_CU_TOT  AS nchar(100)) AS CONC_ROUG2_CU_TOT FROM LABORATORIO_RAIOX", con)
    carta_controle_pims = pd.read_sql_query("SELECT * FROM CARTA_CONTROLE_PIMS", con)
    balanco_de_massas = pd.read_sql_query("SELECT * FROM BALANCO_DE_MASSAS", con)

    con.close()

    laboratorio['DATA'] = pd.to_datetime(laboratorio['DATA'], format='%Y-%m-%d %H:%M:%S')
    laboratorio = laboratorio[laboratorio['DATA'] >= "2023-06-01 00:00:00.000"]

    laboratorio["DATA"] = laboratorio["DATA"].dt.strftime("%Y-%m-%d %H:%M:%S")
    laboratorio_raiox["DATA"] = laboratorio_raiox["DATA"].dt.strftime("%Y-%m-%d %H:%M:%S")
    carta_controle_pims["DATA"] = carta_controle_pims["DATA"].dt.strftime("%Y-%m-%d %H:%M:%S")
    balanco_de_massas["DATA"] = balanco_de_massas["DATA"].dt.strftime("%Y-%m-%d %H:%M:%S")

    laboratorio.to_excel('app/data/01_raw_data/laboratorio.xlsx', index=False)
    laboratorio.to_excel('data/01_raw_data/laboratorio.xlsx', index=False)
    laboratorio_raiox.to_excel('app/data/01_raw_data/laboratorio_raiox.xlsx', index=False)
    laboratorio_raiox.to_excel('data/01_raw_data/laboratorio_raiox.xlsx', index=False)
    carta_controle_pims.to_excel('app/data/01_raw_data/carta_controle_pims.xlsx', index=False)
    carta_controle_pims.to_excel('data/01_raw_data/carta_controle_pims.xlsx', index=False)
    balanco_de_massas.to_excel('app/data/01_raw_data/balanco_de_massas.xlsx', index=False)
    balanco_de_massas.to_excel('data/01_raw_data/balanco_de_massas.xlsx', index=False)

    con_mvv = pyodbc.connect(
        driver="ODBC Driver 17 for SQL Server",
        server="192.168.5.249",
        database="mining_control_mvv",
        uid="user_bi",
        pwd="rXV7aWUd4Uq9yWpW"
    )

    DataFi = dt.date.today()
    DataIn = DataFi - dt.timedelta(days=60)
    ListEquips = '1,2,3' 

    sql_query_mvv = f"EXECUTE [dbo].[rpt_qualidade_movimentacao_detalhada] " \
                    f"@DataIn = '{DataIn}', " \
                    f"@DataFi = '{DataFi}', " \
                    f"@ListEquips = '{ListEquips}'"

    blend = pd.read_sql_query(sql_query_mvv, con_mvv)

    con_mvv.close()

    print(blend)

    blend = blend[blend['Destino_Area_CM'] == "BRITADOR"]

    blend.to_excel('app/data/01_raw_data/blend.xlsx', index=False)
    blend.to_excel('data/01_raw_data/blend.xlsx', index=False)

    print("Dados carregados")
